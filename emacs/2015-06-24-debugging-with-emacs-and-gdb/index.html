<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Concept → IO () &middot; Dominik Schrempf</title>

  
  <link rel="stylesheet" href="https://dschrempf.github.io/css/poole.css">
  <link rel="stylesheet" href="https://dschrempf.github.io/css/hyde.css">
  <link rel="stylesheet" href="https://dschrempf.github.io/css/poole-overrides.css">
  <link rel="stylesheet" href="https://dschrempf.github.io/css/hyde-overrides.css">
  <link rel="stylesheet" href="https://dschrempf.github.io/css/hyde-x.css">
  <link rel="stylesheet" href="https://dschrempf.github.io/css/highlight/github.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css">
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script>
  <link rel="stylesheet" href="https://dschrempf.github.io/css/myblog.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://dschrempf.github.io/touch-icon-144-precomposed.png">
  <link href="https://dschrempf.github.io/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="Use GDB from withing Emacs to debug source code.">
  <meta name="keywords" content="GDB,,,,,">
  
</head>
<body class="theme-base-0d">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
        <img style="border-radius:50%"
             src="https://www.gravatar.com/avatar/b05a00fb86fa378973181afd07c7e548?s=200"
             alt="gravatar" title="Dominik Schrempf">
      
      <h1>Concept → IO ()</h1>
      <p class="lead">A collection of articles about Linux, Emacs, coding and music.</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="https://dschrempf.github.io/">Blog</a></li>
      
      <li class="sidebar-nav-item">&ensp;<a href="https://dschrempf.github.io/linux/">Linux</a></li>
      
      <li class="sidebar-nav-item">&ensp;<a href="https://dschrempf.github.io/emacs/">Emacs</a></li>
      
      <li class="sidebar-nav-item">&ensp;<a href="https://dschrempf.github.io/coding/">Coding</a></li>
      
      <li class="sidebar-nav-item">&ensp;<a href="https://dschrempf.github.io/music/">Music</a></li>
      
      
      <li class="sidebar-nav-item"><a href="https://dschrempf.github.io/links/">Links</a></li>
      
      <li class="sidebar-nav-item"><a href="https://dschrempf.github.io/about/">About</a></li>
      
    </ul><br/>

    <ul class="sidebar-nav">
        <li class="sidebar-nav-item">
            <a href="https://github.com/dschrempf" target="_blank"><i class="fa fa-github fa-1x"></i></a>
            
            <a href="https://www.stackoverflow.com/users/3536806" target="_blank"><i class="fa fa-stack-overflow fa-1x"></i></a>
            
            
            
            <a href="https://twitter.com/fazky" target="_blank"><i class="fa fa-twitter fa-1x"></i></a>
            
            <a href="https://orcid.org/0000-0001-8865-9237" target="_blank"><i class="ai ai-orcid ai-1x"></i></a>
            <a href="mailto:dominik.schrempf@gmail.com"><i class="fa fa-envelope fa-1x"></i></a>
            <a href="/gpg_public_key.txt"><i class="fa fa-key fa-1x"></i></a>
            
      </li>
    </ul>

    

    <p>&copy; 2018 Dominik Schrempf <a href="https://dschrempf.github.io/license/">GPL3</a><br/></p>
    

  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">Debugging with Emacs and GDB</h1>
    <span class="post-date">Jun 24, 2015 &middot; 3 minute read &middot; <a href="https://dschrempf.github.io/emacs/2015-06-24-debugging-with-emacs-and-gdb/#disqus_thread">Comments</a>
    </span>
    

<h2 id="introduction">Introduction</h2>

<p>Erroneous source code can be a nasty issue to tackle.  Print
statements that inform you about the states of variables are handy but
sometimes they are unable to represent the intrinsic structure of the
code.  Debuggers allow you to run your code step by step, display and
watch variables and see what is going on <em>inside</em> another program
while it executes.</p>

<h2 id="the-gnu-poject-debugger">The GNU poject debugger</h2>

<p>Here, we will use the <a href="http://www.gnu.org/software/gdb/">GNU project debugger (GDB)</a>, because it is freely
available, very actively developed and can be used on many operating
systems.  It can</p>

<ul>
<li>start your program, specifying anything that might affect its behavior;</li>
<li>make your program stop on specified conditions;</li>
<li>examine what has happened, when your program has stopped;</li>
<li>change things in your program, so you can experiment with correcting
the effects of one bug and go on to learn about another.</li>
</ul>

<h2 id="gdb-in-emacs">GDB in Emacs</h2>

<p>To debug our program, we will use <strong>Emacs</strong> and <strong>C source code</strong>,
although <code>gdb</code> can be used from the command line and can debug many
different languages.</p>

<p>A good overview about debugging in Emacs with GDB can be found in the
<a href="http://www.gnu.org/software/emacs/manual/html_node/emacs/GDB-Graphical-Interface.html#GDB-Graphical-Interface">Emacs manual</a>.</p>

<p>A short step-by-step guide:</p>

<ul>
<li><p>Open and save a new file <code>hello.c</code> with the following contents:</p>

<pre><code class="language-c">#include &lt;stdio.h&gt;

int main(int argc, char* argv[]) {
    int i;
    printf(&quot;hello world\n&quot;);
    for ( i=0;i&lt;10;++i) {
        printf(&quot;%d \n&quot;,i);
    }
    return 0;
}
</code></pre></li>

<li><p>Compile it with <code>M-x compile</code>; enter the command <code>gcc -Wall -g
  hello.c -o hello</code>.  Usually, it is very helpful to compile your
source code with debugging flags (e.g., <code>-g</code> for <code>gcc</code>), so that
nothing is optimized out by the compiler.</p></li>

<li><p>Activate the graphical debugging environment with <code>M-x
  gdb-many-windows</code>.</p></li>

<li><p>Start the debugger with <code>M-x gdb</code>; enter the command <code>gdb -i=mi
  hello</code>.</p></li>
</ul>

<p>From withing the Grand Unified Debugger (GUD) buffer, you can run
(<code>r</code>) the program to its end or to the first break point, start
(<code>start</code>) and run in until the beginning of the main procedure.  You
can execute the program line-by-line (<code>n</code>) or step into functions with
<code>s</code>.</p>

<p>Breakpoints can be set from withing the source buffer by clicking on
the fringe or with <code>C-x C-a C-b</code>.</p>

<h2 id="customize-gdb">Customize GDB</h2>

<p>To permanently set the nice GDB user interface layout, put</p>

<pre><code class="language-lisp">(setq gdb-many-windows t)
</code></pre>

<p>into your <code>.emacs</code> file.  I have also written a function, that
facilitates the starting of the debugger:</p>

<pre><code class="language-lisp">(defvar gdb-my-history nil &quot;History list for dom-gdb-MYPROG.&quot;)
(defun dom-gdb-MYPROG ()
  &quot;Debug MYPROG with `gdb'.&quot;
  (interactive)
  (let* ((wd &quot;/path/to/working/directory&quot;)
         (pr &quot;/path/to/executable&quot;)
         (dt &quot;/path/to/datafile&quot;)
         (guess (concat &quot;gdb -i=mi -cd=&quot; wd &quot; --args &quot; pr &quot; -s &quot; dt))
         (arg (read-from-minibuffer &quot;Run gdb (like this): &quot;
                                    guess nil nil 'gdb-my-history)))
    (gdb arg)))
</code></pre>

<h2 id="window-management">Window management</h2>

<p>Upon debugging a program with many source files, GDB displays new
source files in (random?) windows in your Emacs frame.  This is
especially tedious if you use <code>gdb-many-windows</code>.  I have written a
function <code>dom-gdb-restore-windows</code>, that resets the display and fixes
the window layout:</p>

<pre><code class="language-lisp">(defun dom-gdb-restore-windows ()
  &quot;Restore GDB session.&quot;
  (interactive)
  (if (eq gdb-many-windows t)
      (gdb-restore-windows)
    (dom-gdb-restore-windows-gud-io-and-source)))

(defun dom-gdb-restore-windows-gud-io-and-source ()
  &quot;Restore GUD buffer, IO buffer and source buffer next to each other.&quot;
  (interactive)
  ;; Select dedicated GUD buffer.
  (switch-to-buffer gud-comint-buffer)
  (delete-other-windows)
  (set-window-dedicated-p (get-buffer-window) t)
  (when (or gud-last-last-frame gdb-show-main)
    (let ((side-win (split-window nil nil t))
          (bottom-win (split-window)))
      ;; Put source to the right.
      (set-window-buffer
       side-win
       (if gud-last-last-frame
           (gud-find-file (car gud-last-last-frame))
         (gud-find-file gdb-main-file)))
      (setq gdb-source-window side-win)
      ;; Show dedicated IO buffer below.
      (set-window-buffer
       bottom-win
       (gdb-get-buffer-create 'gdb-inferior-io))
      (set-window-dedicated-p bottom-win t))))

(defun dom-gdb-display-source-buffer ()
  &quot;Display gdb source buffer if it is set.&quot;
  (interactive)
  (when (or gud-last-last-frame gdb-show-main)
    (switch-to-buffer
     (if gud-last-last-frame
         (gud-find-file (car gud-last-last-frame))
       (gud-find-file gdb-main-file))))
  (delete-other-windows))
</code></pre>

  </div>
  <div id="disqus_thread"></div>
</div>


<script type="text/javascript">
var disqus_shortname = "fazky";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



<script type="text/javascript">
    var disqus_shortname = "fazky";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script src="https://dschrempf.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

