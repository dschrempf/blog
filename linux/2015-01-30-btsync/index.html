<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>BitTorrent Sync over SSH proxy &middot; Dominik Schrempf</title>

  
  <link rel="stylesheet" href="https://dschrempf.github.io/css/poole.css">
  <link rel="stylesheet" href="https://dschrempf.github.io/css/hyde.css">
  <link rel="stylesheet" href="https://dschrempf.github.io/css/poole-overrides.css">
  <link rel="stylesheet" href="https://dschrempf.github.io/css/hyde-overrides.css">
  <link rel="stylesheet" href="https://dschrempf.github.io/css/hyde-x.css">
  <link rel="stylesheet" href="https://dschrempf.github.io/css/highlight/github.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css">
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script>
  <link rel="stylesheet" href="https://dschrempf.github.io/css/myblog.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://dschrempf.github.io/touch-icon-144-precomposed.png">
  <link href="https://dschrempf.github.io/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="Use BitTorrent Sync over an SSH SOCKS Proxy">
  <meta name="keywords" content="BTSync,,,,,">
  
</head>
<body class="theme-base-darkblue">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
        <img style="border-radius:50%"
             src="https://www.gravatar.com/avatar/b05a00fb86fa378973181afd07c7e548?s=200"
             alt="gravatar" title="Dominik Schrempf">
      
      <h1>Concept â†’ IO ()</h1>
      <p class="lead">A collection of articles about Linux, Emacs, coding and music.</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="https://dschrempf.github.io/">Blog</a></li>
      
      <li class="sidebar-nav-item">&ensp;<a href="https://dschrempf.github.io/linux/">Linux</a></li>
      
      <li class="sidebar-nav-item">&ensp;<a href="https://dschrempf.github.io/emacs/">Emacs</a></li>
      
      <li class="sidebar-nav-item">&ensp;<a href="https://dschrempf.github.io/coding/">Coding</a></li>
      
      <li class="sidebar-nav-item">&ensp;<a href="https://dschrempf.github.io/music/">Music</a></li>
      
      
      <li class="sidebar-nav-item"><a href="https://dschrempf.github.io/links/">Links</a></li>
      
      <li class="sidebar-nav-item"><a href="https://dschrempf.github.io/about/">About</a></li>
      
    </ul><br/>

    <ul class="sidebar-nav">
        <li class="sidebar-nav-item">
            <a href="https://github.com/dschrempf" target="_blank"><i class="fa fa-github fa-1x"></i></a>
            
            <a href="https://www.stackoverflow.com/users/3536806" target="_blank"><i class="fa fa-stack-overflow fa-1x"></i></a>
            
            
            
            <a href="https://twitter.com/fazky" target="_blank"><i class="fa fa-twitter fa-1x"></i></a>
            
            <a href="https://orcid.org/0000-0001-8865-9237" target="_blank"><i class="ai ai-orcid ai-1x"></i></a>
            <a href="mailto:dominik.schrempf@gmail.com"><i class="fa fa-envelope fa-1x"></i></a>
            <a href="/gpg_public_key.txt"><i class="fa fa-key fa-1x"></i></a>
            
      </li>
    </ul>

    

    <p>&copy; 2018 Dominik Schrempf <a href="https://dschrempf.github.io/license/">GPL3</a><br/></p>
    

  </div>
</div>



<div class="content container">
  <div class="post">
    <h1 class="post-title">BitTorrent Sync over SSH proxy</h1>
    <span class="post-date">Jan 30, 2015 &middot; 4 minute read &middot; <a href="https://dschrempf.github.io/linux/2015-01-30-btsync/#disqus_thread">Comments</a>
    </span>
    

<p><span class="timestamp-wrapper"><span class="timestamp">&lt;2015-04-22 Wed&gt; </span></span> I have switched from BitTorrent Sync to <a href="https://syncthing.net/">Syncthing</a>.
Reasons are:</p>

<ul>
<li>the synchronization was not reliable (synchronization stalled
sometimes; every update leads to a re-synchronization of all files);</li>
<li>the corporate policy is not to my liking (a Pro version is
available; the free version only supports a limited amount of
folders and clients; it is not sure if it will stay free in the
future).</li>
</ul>

<p>Please also refer to the blog entry that describes how to configure
<a href="/linux/2015-04-22-syncthing/">Syncthing with SSH port forwarding</a>.</p>

<h2 id="introduction">Introduction</h2>

<p><span class="timestamp-wrapper"><span class="timestamp">&lt;2015-01-30 Fri&gt; </span></span> <a href="http://www.getsync.com/">BitTorrent Sync</a> is a nice program that lets you sync
two clients using advanced peer-to-peer technology.  It can be a very
good replacement for Dropbox if you do not want to share files with
others (although you could still use Dropbox for file sharing with
others).  Especially so, because it does not save any of your data on
a server and synchronization is encrypted.  Furthermore, it can be
installed very easily on Linux (and even on a Mac and on Windows).
Please see the installation instructions on their homepage.</p>

<p>The problem I had is that one of my clients (say client A) is behind a
firewall.  In order to circumvent it, we need a client B that has full
access to the internet and that is accessible by client A; then we ca
set up an SSH SOCKS proxy; check it out.</p>


<figure>
    
        <img src="/ox-hugo/firewall-ssh-proxy.png" />
    
    
</figure>


<h2 id="setup-of-ssh-tunnel">Setup of SSH tunnel</h2>

<p>In order for this to work, you need SSH access from client A to client
B.  Client B needs to have access to the internet.  Then you can setup
a dynamic SSH tunnel at client A with:</p>

<pre><code class="language-sh">ssh -vvv -N -D 1080 username@clientB
</code></pre>

<dl>
<dt><code>-vvv</code></dt>
<dd>Increase verbosity to a high level, so that you can debug
problems if you have any (can be removed later).</dd>
<dt><code>-N</code></dt>
<dd>Do not open an interactive session (no commands can be
entered at prompt).</dd>
<dt><code>-D 1080</code></dt>
<dd>Dynamically forward all requests to <code>localhost:1080</code> to
client B (act as a SOCKS proxy on port 1080; if you are
interested please see, e.g., <a href="https://help.ubuntu.com/community/SSH/OpenSSH/PortForwarding">port forwarding</a>).</dd>
</dl>

<p>If this worked out, every process on client A that accesses
<code>localhost:1080</code> will be forwarded to client B that is outside the
firewall.  I.e., you could also tell Firefox to use this SOCKS proxy
so that you can access sites that you cannot otherwise.  Actually this
is a very good idea to test if the SOCKS proxy works in general.</p>

<h2 id="btsync-setup">BTSync setup</h2>

<p>Now, BTSync should automatically find this SOCKS proxy (because it is
using the standard port 1080; my BTSync version is <code>1.4.106</code>) and uses
it to circumvent the firewall.  The very good and informative debug
output of the SSH tunnel can be used to identify possible problems.  A
sample configuration file looks like this:</p>

<p><span class="timestamp-wrapper"><span class="timestamp">&lt;2015-04-01 Wed&gt; </span></span> The automatic detection of the SOCKS proxy did not
work anymore (BTSync version <code>2.0.93</code>).  I have adjusted the
configuration file below.</p>

<pre><code class="language-java">{
  &quot;device_name&quot; : &quot;username@clientA&quot;,
  &quot;listening_port&quot; : 0, // 0 - randomize port.

  /* The storage_path dir contains auxilliary app files if no
   storage_path field: .sync dir created in the directory where binary
   is located. otherwise user-defined directory will be used. */
  &quot;storage_path&quot; : &quot;/home/username/.btsync&quot;,

  // Set location of pid file.
  &quot;pid_file&quot; : &quot;/home/username/.btsync/btsync.pid&quot;,

  // Do not use UPnP for port mapping.
  &quot;use_upnp&quot; : false,

  // limits in kB/s. 0 - no limit.
  &quot;download_limit&quot; : 0,
  &quot;upload_limit&quot; : 0,

  // Proxy configuration
  &quot;proxy_type&quot; : &quot;socks4&quot;, // Valid types: &quot;socks4&quot;, &quot;socks5&quot;, &quot;http_connect&quot;. Any other value means no proxy
  &quot;proxy_addr&quot; : &quot;127.0.0.1&quot;, // IP address of proxy server.
  &quot;proxy_port&quot; : 1080,

  // Do not use the webui.
  &quot;webui&quot; :
  {
    &quot;listen&quot; : &quot;0.0.0.0:8889&quot;
  },

  /* !!! If you set shared folders in config file WebUI will be
  DISABLED !!!  Shared directories specified in config file override
  the folders previously added from WebUI. */

  &quot;shared_folders&quot; :
  [
    {
      &quot;secret&quot; : &quot;MYSECRET&quot;, // required field - use --generate-secret in command line to create new secret
      &quot;dir&quot; : &quot;/home/username/BTSync&quot;, // * required field
      &quot;use_relay_server&quot; : true, //  use relay server when direct connection fails
      &quot;use_tracker&quot; : true,
      &quot;use_dht&quot; : false,
      &quot;search_lan&quot; : true,
      &quot;use_sync_trash&quot; : true, // enable SyncArchive to store files deleted on remote devices
      &quot;overwrite_changes&quot; : false, // restore modified files to original version, ONLY for Read-Only folders
      &quot;known_hosts&quot; : // specify hosts to attempt connection without additional search
      [
      ]
    }
  ]
}
</code></pre>

  </div>
  <div id="disqus_thread"></div>
</div>


<script id="dsq-count-scr" src="//dschrempf.disqus.com/count.js" async></script>
<script>
 var disqus_shortname = "dschrempf";
 var disqus_config = function () {
     this.page.url = "https://dschrempf.github.io/linux/2015-01-30-btsync/";
     this.page.identifier = "BitTorrent Sync over SSH proxy";
 };
 (function() {
     var d = document, s = d.createElement('script');
     s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
     s.setAttribute('data-timestamp', +new Date());
     (d.head || d.body).appendChild(s);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


<script src="https://dschrempf.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

