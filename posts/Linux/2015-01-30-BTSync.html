<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>BitTorrent Sync over SSH Proxy</title>
<!-- 2015-03-11 Wed 22:36 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Dominik Schrempf" />
<meta  name="description" content="Use BitTorrent Sync over an SSH SOCKS Proxy"
 />
<meta  name="keywords" content="BTSync, BitTorrent, Sync, SOCKS, Proxy, SSH" />
<link rel='stylesheet' href='/css/site.css' type='text/css'/>
<meta name="viewport" content="width=device-width">
</head>
<body>
<div id="preamble" class="status">
<div class='nav'>
<ul>
<li><a href='/'>Home</a></li>
<li><a href='/archive.html'>Archive</a></li>
<li><a href='http://github.com/fazky'>GitHub</a></li>
</ul>
</div>
</div>
<div id="content">
<h1 class="title">BitTorrent Sync over SSH Proxy</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#unnumbered-1">Introduction</a></li>
<li><a href="#unnumbered-2">Setup of SSH Tunnel</a></li>
<li><a href="#unnumbered-3">BTSync Setup</a></li>
</ul>
</div>
</div>

<div id="outline-container-unnumbered-1" class="outline-2">
<h2 id="unnumbered-1">Introduction</h2>
<div class="outline-text-2" id="text-unnumbered-1">
<p>
<span class="timestamp-wrapper"><span class="timestamp">&lt;2015-01-30 Fri&gt; </span></span> <a href="http://www.getsync.com/">BitTorrent Sync</a> is a nice program that lets you sync
two clients using advanced peer-to-peer technology.  It can be a very
good replacement for Dropbox if you do not want to share files with
others (although you could still use Dropbox for file sharing with
others).  Especially so, because it does not save any of your data on
a server and synchronization is encrypted.  Furthermore, it can be
installed very easily on Linux (and even on a Mac and on Windows).
Please see the installation instructions on their homepage.
</p>

<p>
The problem I had is that one of my clients (say Client A) is behind a
firewall.  In order to circumvent it, we need a Client B that has full
access to the internet and that is accessible by Client A; then we ca
set up an SSH SOCKS proxy; check it out.
</p>


<div class="figure">
<p><img src="firewall-ssh-proxy.png" alt="firewall-ssh-proxy.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-unnumbered-2" class="outline-2">
<h2 id="unnumbered-2">Setup of SSH Tunnel</h2>
<div class="outline-text-2" id="text-unnumbered-2">
<p>
In order for this to work, you need SSH access from client A to client
B.  Client B needs to have access to the internet.  Then you can setup
a dynamic SSH tunnel at client A with:
</p>
<div class="org-src-container">

<pre class="src src-sh">ssh -vvv -N -D 1080 username@clientB
</pre>
</div>
<dl class="org-dl">
<dt><code>-vvv</code></dt><dd>Increase verbosity to a high level, so that you can debug
problems if you have any (can be removed later).</dd>
<dt><code>-N</code></dt><dd>Do not open an interactive session (no commands can be
entered at prompt).</dd>
<dt><code>-D 1080</code></dt><dd>Dynamically forward all requests to <code>localhost:1080</code> to
client B (act as a SOCKS proxy on port 1080; if you are
interested please see, e.g., <a href="https://help.ubuntu.com/community/SSH/OpenSSH/PortForwarding">port forwarding</a>).</dd>
</dl>

<p>
If this worked out, every process on client A that accesses
<code>localhost:1080</code> will be forwarded to client B that is outside the
firewall.  I.e., you could also tell Firefox to use this SOCKS proxy
so that you can access sites that you cannot otherwise.  Actually this
is a very good idea to test if the SOCKS proxy works in general.
</p>
</div>
</div>

<div id="outline-container-unnumbered-3" class="outline-2">
<h2 id="unnumbered-3">BTSync Setup</h2>
<div class="outline-text-2" id="text-unnumbered-3">
<p>
Now, BTSync should automatically find this SOCKS proxy (because it is
using the standard port 1080; my BTSync version is <code>1.4.106</code>) and uses
it to circumvent the firewall.  The very good and informative debug
output of the SSH tunnel can be used to identify possible problems.  A
sample configuration file looks like this:
</p>

<div class="org-src-container">

<pre class="src src-java">{
  <span style="color: #008000;">"device_name"</span> : <span style="color: #008000;">"username@clientA"</span>,
  <span style="color: #008000;">"listening_port"</span> : 0, <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">0 - randomize port.</span>

  <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">The storage_path dir contains auxilliary app files if no</span>
<span style="color: #8D8D84; font-style: italic;">   storage_path field: .sync dir created in the directory where binary</span>
<span style="color: #8D8D84; font-style: italic;">   is located. otherwise user-defined directory will be used. */</span>
  <span style="color: #008000;">"storage_path"</span> : <span style="color: #008000;">"/home/username/.btsync"</span>,

  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Set location of pid file.</span>
  <span style="color: #008000;">"pid_file"</span> : <span style="color: #008000;">"/home/username/.btsync/btsync.pid"</span>,

  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Do not use UPnP for port mapping.</span>
  <span style="color: #008000;">"use_upnp"</span> : <span style="color: #D0372D;">false</span>,

  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">limits in kB/s. 0 - no limit.</span>
  <span style="color: #008000;">"download_limit"</span> : 0,
  <span style="color: #008000;">"upload_limit"</span> : 0,

  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Proxy configuration --- not needed.</span>

  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Do not use the webui.</span>
  <span style="color: #008000;">"webui"</span> :
  {
    <span style="color: #008000;">"listen"</span> : <span style="color: #008000;">"0.0.0.0:8889"</span>
  },

  <span style="color: #8D8D84;">/* </span><span style="color: #8D8D84; font-style: italic;">!!! If you set shared folders in config file WebUI will be</span>
<span style="color: #8D8D84; font-style: italic;">  DISABLED !!!  Shared directories specified in config file override</span>
<span style="color: #8D8D84; font-style: italic;">  the folders previously added from WebUI. */</span>

  <span style="color: #008000;">"shared_folders"</span> :
  [
    {
      <span style="color: #008000;">"secret"</span> : <span style="color: #008000;">"MYSECRET"</span>, <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">required field - use --generate-secret in command line to create new secret</span>
      <span style="color: #008000;">"dir"</span> : <span style="color: #008000;">"/home/username/BTSync"</span>, <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">* required field</span>
      <span style="color: #008000;">"use_relay_server"</span> : <span style="color: #D0372D;">true</span>, <span style="color: #8D8D84;">//  </span><span style="color: #8D8D84; font-style: italic;">use relay server when direct connection fails</span>
      <span style="color: #008000;">"use_tracker"</span> : <span style="color: #D0372D;">true</span>,
      <span style="color: #008000;">"use_dht"</span> : <span style="color: #D0372D;">false</span>,
      <span style="color: #008000;">"search_lan"</span> : <span style="color: #D0372D;">true</span>,
      <span style="color: #008000;">"use_sync_trash"</span> : <span style="color: #D0372D;">true</span>, <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">enable SyncArchive to store files deleted on remote devices</span>
      <span style="color: #008000;">"overwrite_changes"</span> : <span style="color: #D0372D;">false</span>, <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">restore modified files to original version, ONLY for Read-Only folders</span>
      <span style="color: #008000;">"known_hosts"</span> : <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">specify hosts to attempt connection without additional search</span>
      [
      ]
    }
  ]
}
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<div id='disqus_thread'></div>
<script type='text/javascript'>
  var disqus_shortname = 'Fazky'; // required: replace example with your forum shortname
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript><p>Please enable JavaScript to view the <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a></p></noscript><div class='footer'>
Copyright 2014 Dominik Schrempf<br/>
Last updated 2015-03-11 <br/>
Built with <a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.4.1 (<a href="http://orgmode.org">Org</a> mode 8.3beta) <br/>
<a href="http://validator.w3.org/check?uri=referer">Validate</a> HTML
</div>
<script type='text/javascript'>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

 ga('create', 'UA-57993874-1', 'auto');
 ga('send', 'pageview');

</script>
</div>
</body>
</html>
